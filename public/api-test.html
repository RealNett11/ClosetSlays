<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
</head>
<body>
    <h1>ClosetSlays API Test</h1>
    <div id="results"></div>
    
    <script>
        // Test multiple URLs to find the working one
        const API_URLS = [
            'https://webhook.closetslays.com',
            'https://helpmegod-j3vkv.ondigitalocean.app',
            'http://helpmegod-j3vkv.ondigitalocean.app'  // Try HTTP too
        ];
        const results = document.getElementById('results');
        
        async function testEndpoint(apiBase, method, endpoint, body = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (body) {
                    options.body = JSON.stringify(body);
                }
                
                const url = `${apiBase}${endpoint}`;
                console.log(`Testing: ${url}`);
                
                const response = await fetch(url, options);
                const contentType = response.headers.get('content-type');
                
                let responseText;
                if (contentType && contentType.includes('application/json')) {
                    responseText = JSON.stringify(await response.json(), null, 2);
                } else {
                    responseText = await response.text();
                }
                
                results.innerHTML += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid ${response.ok ? 'green' : 'red'};">
                        <h3>${method} ${url}</h3>
                        <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                        <p><strong>Content-Type:</strong> ${contentType}</p>
                        <pre style="background: #f5f5f5; padding: 10px; overflow-x: auto;">${responseText}</pre>
                    </div>
                `;
                
                return response.ok;
            } catch (error) {
                results.innerHTML += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid red;">
                        <h3>${method} ${apiBase}${endpoint}</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
                return false;
            }
        }
        
        // Test all URLs
        (async () => {
            results.innerHTML = '<h2>Testing API URLs...</h2>';
            
            for (const apiBase of API_URLS) {
                results.innerHTML += `<h3>Testing: ${apiBase}</h3>`;
                
                // Test basic connectivity first
                await testEndpoint(apiBase, 'GET', '/');
                await testEndpoint(apiBase, 'GET', '/api/health');
                await testEndpoint(apiBase, 'GET', '/api');
                
                // If health check works, test more endpoints
                const healthWorking = await testEndpoint(apiBase, 'GET', '/api/health');
                if (healthWorking) {
                    await testEndpoint(apiBase, 'POST', '/api/create-payment-intent', { 
                        items: [{ id: 1, name: 'Test', price: 20, quantity: 1 }] 
                    });
                }
                
                results.innerHTML += '<hr>';
            }
        })();
    </script>
</body>
</html>
